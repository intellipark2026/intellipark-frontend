<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Select Parking Level - IntelliPark</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'SF Pro Display', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 40%, #f2f2f2 100%);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Navbar */
    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(10px);
      padding: 15px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      border-bottom: 2px solid rgb(124, 120, 120);
      z-index: 1000;
    }

    .navbar a {
      text-decoration: none;
      color: white;
      font-weight: bold;
      font-size: 18px;
      display: flex;
      align-items: center;
    }

    .navbar img {
      height: 40px;
      margin-right: 10px;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
    }

    /* Title */
    h2 {
      font-size: 36px;
      font-weight: 700;
      margin-top: 120px;
      margin-bottom: 40px;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
      color: #f8f8f8;
    }

    /* Container */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      width: 90%;
      max-width: 700px;
    }

    .floor-container {
      width: 100%;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 35px;
      text-align: left;
      box-shadow: 0 10px 40px rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      transition: all 0.3s ease;
      cursor: pointer;
      color: #eee;
    }

    .floor-container:hover:not(.disabled) {
      transform: scale(1.02);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }

    .disabled {
      opacity: 0.4;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Titles & Counts */
    .floor-title {
      font-size: 24px;
      font-weight: 700;
      color: white;
      margin-bottom: 18px;
    }

    .counts-row {
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 16px;
      color: #ccc;
      font-family: "Courier New", monospace;
    }

    .count-label {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: currentColor;
      box-shadow: 0 0 8px currentColor;
    }

    .available { color: #3eff5e; }
    .reserved { color: #2b39ff; }
    .occupied { color: #ff4343; }

    /* Glow Styles */
    .glow-available {
      border-color: #3eff5e;
      box-shadow: 0 0 25px #3eff5e80, inset 0 0 10px #3eff5e40;
      animation: pulse-green 1.8s infinite alternate;
    }

    .glow-occupied {
      border-color: #ff4343;
      box-shadow: 0 0 25px #ff434380, inset 0 0 10px #ff434340;
      animation: pulse-red 1.8s infinite alternate;
    }

    @keyframes pulse-green {
      from { box-shadow: 0 0 25px #3eff5e80, inset 0 0 10px #3eff5e40; }
      to { box-shadow: 0 0 50px #3eff5eff, inset 0 0 20px #3eff5e80; }
    }

    @keyframes pulse-red {
      from { box-shadow: 0 0 25px #ff434380, inset 0 0 10px #ff434340; }
      to { box-shadow: 0 0 50px #ff4343ff, inset 0 0 20px #ff434380; }
    }

    @media (max-width: 768px) {
      .floor-container {
        padding: 25px;
      }
      h2 { font-size: 28px; }
      .floor-title { font-size: 20px; }
    }
  </style>
</head>

<body>

  <div class="navbar">
    <a id="homeBtn" href="intelli.html">
      <img src="logo.png" alt="IntelliPark Logo">
      <span>INTELLIPARK</span>
    </a>
  </div>

  <h2>Select Parking Level</h2>

  <div class="container">
    <div class="floor-container" id="floor1" onclick="attemptBooking('1st Floor')">
      <div class="floor-title">1st Floor</div>
      <div class="counts-row">
        <div class="count-label"><span class="dot available"></span> Available: <span id="floor1-available">0</span></div>
        <div class="count-label"><span class="dot reserved"></span> Reserved: <span id="floor1-reserved">0</span></div>
        <div class="count-label"><span class="dot occupied"></span> Occupied: <span id="floor1-occupied">0</span></div>
      </div>
    </div>

    <div class="floor-container" id="floor2" onclick="attemptBooking('2nd Floor')">
      <div class="floor-title">2nd Floor</div>
      <div class="counts-row">
        <div class="count-label"><span class="dot available"></span> Available: <span id="floor2-available">0</span></div>
        <div class="count-label"><span class="dot reserved"></span> Reserved: <span id="floor2-reserved">0</span></div>
        <div class="count-label"><span class="dot occupied"></span> Occupied: <span id="floor2-occupied">0</span></div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAuH0ng67kSk0arMNOxujgIpnBVr0pwNWE",
      authDomain: "intellipark2025-327e9.firebaseapp.com",
      databaseURL: "https://intellipark2025-327e9-default-rtdb.firebaseio.com",
      projectId: "intellipark2025-327e9",
      storageBucket: "intellipark2025-327e9.appspot.com",
      messagingSenderId: "126333727252",
      appId: "1:126333727252:web:ffa87b61f5e7b3a2122d01"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const floorSlots = {
      1: ['slot1', 'slot2'],
      2: ['slot3', 'slot4'],
    };

    let slotStatuses = {
      slot1: "Loading...", slot2: "Loading...",
      slot3: "Loading...", slot4: "Loading..."
    };

    // Real-time slot monitoring
    Object.keys(slotStatuses).forEach(slotId => {
      db.ref(`/${slotId}/status`).on("value", snap => {
        slotStatuses[slotId] = snap.val();
        updateCountsAndGlow();
      });
    });

    // Update counts + glow effect
    function updateCountsAndGlow() {
      [1, 2].forEach(floorNum => {
        const slots = floorSlots[floorNum];
        let available = 0, reserved = 0, occupied = 0;

        slots.forEach(slotId => {
          const s = slotStatuses[slotId];
          if (s === "Available") available++;
          else if (s === "Reserved") reserved++;
          else if (s === "Occupied") occupied++;
        });

        document.getElementById(`floor${floorNum}-available`).textContent = available;
        document.getElementById(`floor${floorNum}-reserved`).textContent = reserved;
        document.getElementById(`floor${floorNum}-occupied`).textContent = occupied;

        const floorDiv = document.getElementById(`floor${floorNum}`);
        floorDiv.classList.remove('glow-available', 'glow-occupied', 'disabled');

        if (available > 0) {
          floorDiv.classList.add('glow-available');
        } else {
          floorDiv.classList.add('glow-occupied', 'disabled');
        }
      });
    }

    // Booking logic
    function attemptBooking(floorName) {
      let slotToBook = null;
      if (floorName === "1st Floor") {
        if (slotStatuses["slot1"] === "Available") slotToBook = "slot1";
        else if (slotStatuses["slot2"] === "Available") slotToBook = "slot2";
      } else {
        if (slotStatuses["slot3"] === "Available") slotToBook = "slot3";
        else if (slotStatuses["slot4"] === "Available") slotToBook = "slot4";
      }

      if (!slotToBook) return;
      if (confirm(`Do you want to reserve a slot on ${floorName}?`)) {
        window.location.href = `booking.html?slot=${slotToBook}`;
      }
    }

    // Home link adjuster
    document.addEventListener("DOMContentLoaded", function() {
      const btn = document.getElementById("homeBtn");
      if (btn) {
        btn.href = (location.hostname === "127.0.0.1" || location.hostname === "localhost")
          ? "http://127.0.0.1:5500/public/intelli.html"
          : "intelli.html";
      }
    });
  </script>
</body>
</html>
